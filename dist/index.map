{"version":3,"sources":["screencapture.js","pick.js","ipcMainHandler.js","index.js"],"names":["global","html2canvas","canvas","obj","onrendered","getStream","Promise","resolve","reject","getSources","types","error","sources","display","getDisplay","sourceId","displayIndex","screen","getAllDisplays","item","id","navigator","webkitGetUserMedia","audio","video","mandatory","chromeMediaSource","chromeMediaSourceId","maxWidth","size","width","maxHeight","height","minWidth","minHeight","getVideo","document","createElement","autoplay","src","URL","createObjectURL","stream","addEventListener","getCanvas","drawFrame","ctx","x","y","availTop","drawImage","getFrameImage","toDataURL","console","log","getLoop","requestId","callFn","requestAnimationFrame","fn","cancelAnimationFrame","startRecording","recorder","type","getContext","stopLoop","stop","stopRecording","getDataURL","url","pause","pauseRecording","resume","resumeRecording","takeScreenshot","bounds","then","captureVideo","require","remote","BrowserWindow","path","ipc","ipcRenderer","desktopCapturer","win","exports","pick","replace","transparent","frame","toolbar","setSimpleFullScreen","show","loadURL","join","process","cwd","webContents","on","send","result","event","message","pixels","JSON","parse","data","rgbBox","getElementById","rgbValues","innerHTML","style","backgroundColor","ipcMain","ipcMainHandler","stringify"],"mappings":"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","file":"index.map","sourcesContent":["import RecordRTC from \"recordrtc\";\nimport electron, { desktopCapturer } from \"electron\";\nimport find from \"array-find\";\nimport findIndex from \"lodash.findindex\";\n\n/* This is NEEDED because RecordRTC is badly written */\nglobal.html2canvas = (canvas, obj) => {\n  obj.onrendered(canvas);\n};\n\nconst getStream = sourceId => {\n  return new Promise((resolve, reject) => {\n    desktopCapturer.getSources({ types: [\"screen\"] }, (error, sources) => {\n      if (error) {\n        reject(error);\n        return;\n      }\n\n      const display = getDisplay(sourceId);\n      const displayIndex = findIndex(\n        electron.screen.getAllDisplays(),\n        item => item.id == sourceId\n      );\n\n      navigator.webkitGetUserMedia(\n        {\n          audio: false,\n          video: {\n            mandatory: {\n              chromeMediaSource: \"desktop\",\n              chromeMediaSourceId: sources[displayIndex].id,\n              maxWidth: display.size.width,\n              maxHeight: display.size.height,\n              minWidth: display.size.width,\n              minHeight: display.size.height\n            }\n          }\n        },\n        resolve,\n        reject\n      );\n    });\n  });\n};\n\nconst getVideo = stream => {\n  const video = document.createElement(\"video\");\n  video.autoplay = true;\n  video.src = URL.createObjectURL(stream);\n  return new Promise(resolve => {\n    video.addEventListener(\"playing\", () => {\n      resolve(video);\n    });\n  });\n};\n\nconst getCanvas = (width, height) => {\n  const canvas = document.createElement(\"canvas\");\n  canvas.width = width;\n  canvas.height = height;\n  return canvas;\n};\n\nconst drawFrame = ({\n  ctx,\n  video,\n  x,\n  y,\n  width,\n  height,\n  availTop = screen.availTop\n}) => {\n  ctx.drawImage(video, x, y, width, height, 0, -availTop, width, height);\n};\n\nconst getFrameImage = canvas => {\n  return canvas.toDataURL();\n};\n\nconst getDisplay = id => {\n  const x = find(electron.screen.getAllDisplays(), item => {\n    console.log(item.id, id);\n    return item.id == id;\n  });\n\n  return x;\n};\n\nconst getLoop = fn => {\n  let requestId;\n  const callFn = () => {\n    requestId = requestAnimationFrame(callFn);\n    fn();\n  };\n  callFn();\n  return () => {\n    cancelAnimationFrame(requestId);\n  };\n};\n\nconst startRecording = ({ canvas, video, x, y, width, height, availTop }) => {\n  const recorder = RecordRTC(canvas, { type: \"canvas\" });\n  const ctx = canvas.getContext(\"2d\");\n  const stopLoop = getLoop(() =>\n    drawFrame({ ctx, video, x, y, width, height, availTop })\n  );\n\n  recorder.startRecording();\n\n  return {\n    stop() {\n      return new Promise(resolve => {\n        stopLoop();\n        recorder.stopRecording(() => {\n          recorder.getDataURL(url => resolve({ url, width, height }));\n        });\n      });\n    },\n    pause() {\n      recorder.pauseRecording();\n    },\n    resume() {\n      recorder.resumeRecording();\n    }\n  };\n};\n\nexport const takeScreenshot = ({ x, y, width, height, sourceId }) => {\n  //const availTop = screen.availTop - getDisplay(sourceId).bounds.y;\n\n  const display = getDisplay(sourceId);\n\n  if (typeof x == \"undefined\") x = display.bounds.x;\n  if (typeof y == \"undefined\") y = display.bounds.y;\n  if (typeof width == \"undefined\") width = display.bounds.width;\n  if (typeof height == \"undefined\") height = display.bounds.height;\n\n  const availTop = 0;\n\n  return getStream(sourceId)\n    .then(getVideo)\n    .then(video => {\n      const canvas = getCanvas(width, height);\n      const ctx = canvas.getContext(\"2d\");\n      drawFrame({ ctx, video, x, y, width, height, availTop });\n      return getFrameImage(canvas);\n    });\n};\n\nexport const captureVideo = ({ x, y, width, height, sourceId }) => {\n  const availTop = screen.availTop - getDisplay(sourceId).bounds.y;\n  return getStream(sourceId)\n    .then(getVideo)\n    .then(video => {\n      const canvas = getCanvas(width, height);\n      return startRecording({ canvas, video, x, y, width, height, availTop });\n    });\n};\n","\n\nconst { remote } = require(\"electron\");\n// var robot = require (\"robot-js\");\n\nconst { BrowserWindow } = remote;\nconst path = require('path')\nconst url = require('url');\nconst ipc = require('electron').ipcRenderer;\n// const ipcMain = require('electron').ipcMain;\nconst { desktopCapturer } = require(\"electron\");\nimport { takeScreenshot } from \"./screencapture\";\n\nlet win;\nexports.pick = function () {\n  return new Promise((resolve, reject) => {\n\n    desktopCapturer.getSources({ types: [\"screen\"] }, (error, sources) => {\n      if (error) throw error;\n\n      takeScreenshot({\n        sourceId: sources[0].id.replace(\"screen:\", \"\")\n      }).then(result => {\n          win = new BrowserWindow({\n            transparent: true,\n            frame: false,\n            toolbar: true,\n          });\n          win.setSimpleFullScreen(true);\n          win.show();\n          win.loadURL(path.join('file://', process.cwd(), 'src/screenshot.html'));\n          win.webContents.on('did-finish-load', () => {\n            win.webContents.send('screenshot', result)\n          });\n        });\n    });\n    // win.on('closed', () => {\n    //   win = null\n    // })\n    ipc.on('clickedPixels', (event, message) => {\n      const pixels = JSON.parse(message).data;\n      console.log(pixels, 'pixels selected');\n      let rgbBox = document.getElementById('rgb-color-box');\n      let rgbValues = document.getElementById('rgb-values');\n      rgbValues.innerHTML = `rgba(${pixels[0]},${pixels[1]}, ${pixels[2]}, ${pixels[3]})`\n      rgbBox.style.display = \"inline-block\";\n      rgbBox.style.backgroundColor = `rgba(${pixels[0]},${pixels[1]}, ${pixels[2]}, ${pixels[3]})`;\n      resolve(pixels);\n    });\n\n  });\n}\n","\n  const ipc = require('electron').ipcMain;\n\n  exports.ipcMainHandler = function (win) {\n    ipc.on('clickedPixels', (event, message) => {\n      win.webContents.send('clickedPixels', JSON.stringify(message));\n    })\n  };\n\n","var {pick} = require('./pick');\nvar {ipcMainHandler} = require('./ipcMainHandler');\n\nexports.pick = pick;\nexports.ipcMainHandler = ipcMainHandler;\n"]}